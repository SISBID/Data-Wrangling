---
title: "Data I/O, Part 1"
author: "Data Wrangling in R"
output:
  ioslides_presentation:
    css: styles.css
    widescreen: yes
---

```{r, include = FALSE}
library(knitr)
library(readr)
# suppressPackageStartupMessages(library(dplyr))
knitr::opts_chunk$set(comment = "")
```

## Explaining output on slides

In slides, a command (we'll also call them code or a code chunk) will look like this
```{r code}
print("I'm code")
```

And then directly after it, will be the output of the code.  
So `print("I'm code")` is the code chunk and [1] "I'm code" is the output. 

These slides were made in R using `knitr` and `R Markdown` (covered later today when we discuss reproducible research)

## Data Input

* 'Reading in' data is the first step of any real project/analysis
* R can read almost any file format, especially via add-on packages
* We are going to focus on simple delimited files first
    * tab delimited (e.g. '.txt')
    * comma separated (e.g. '.csv')
    * Microsoft excel (e.g. '.xlsx')

## Data Input

UFO Sightings via Kaggle.com: "Reports of unidentified flying object reports in the last century". 

"There are two versions of this dataset: scrubbed and complete. The complete data includes entries where the location of the sighting was not found or blank (0.8146%) or have an erroneous or blank time (8.0237%). Since the reports date back to the 20th century, some older data might be obscured. Data contains city, state, time, description, and duration of each sighting."

https://www.kaggle.com/NUFORC/ufo-sightings

## R variables 

A few reminders:
* You can create variables from within the R environment and from files on your computer
* Use "<-" to assign values to a variable name
* Variable names are case-sensitive, i.e. X and x are different

```{r assign}
x <- 2
x
x * 4
x + 2
```

## Help

For any function, you can write `?FUNCTION_NAME`, or `help("FUNCTION_NAME")` to look at the help file:

```{r, eval = FALSE}
?dir
help("dir")
```

```{r, echo = FALSE, out.width="70%"}
knitr::include_graphics("media/IO_help.png")
```

## Packages

Not all packages are available on AnVIL's RStudio.

```{r, eval = FALSE}
install.packages("naniar")
AnVIL::install("naniar") # Alternative
library(naniar)
```

```{r, echo = FALSE, out.width="70%"}
knitr::include_graphics("media/IO_help.png")
```

## Data Input

<!-- R Studio features some nice "drop down" support, where you can run some tasks by selecting them from the toolbar. -->

The Easy way: import text datasets using the "File --> Import Dataset --> From Text (readr)" command. Selecting this will bring up a new screen that lets you specify the formatting of your text file. 

Going through this process enters the corresponding R commands in the console (you can copy these for later!)

## Approach #1
* Download data onto your machine from http://sisbid.github.io/Data-Wrangling/data/ufo/ufo_data_complete.csv.gz (right-click this link)
* Upload the data to AnVIL
* Read into RStudio's environment

## Upload the data to AnVIL

```{r, out.width="80%", echo=FALSE, fig.alt='.'}
ottrpal::include_slide("https://docs.google.com/presentation/d/104LQkFTsC5R9vAC4HHj4mK7IjCTH55X6BkrAb3aDd6E/edit#slide=id.g13ea04b780d_1_79")
```

## Upload the data to AnVIL

```{r, out.width="80%", echo=FALSE, fig.alt='.'}
ottrpal::include_slide("https://docs.google.com/presentation/d/104LQkFTsC5R9vAC4HHj4mK7IjCTH55X6BkrAb3aDd6E/edit#slide=id.g13ea04b780d_1_85")
```

## Read into RStudio's environment

```{r, out.width="80%", echo=FALSE, fig.alt='.'}
ottrpal::include_slide("https://docs.google.com/presentation/d/104LQkFTsC5R9vAC4HHj4mK7IjCTH55X6BkrAb3aDd6E/edit#slide=id.g13ea04b780d_1_91")
```

## Read into RStudio's environment

```{r, out.width="80%", echo=FALSE, fig.alt='.'}
ottrpal::include_slide("https://docs.google.com/presentation/d/104LQkFTsC5R9vAC4HHj4mK7IjCTH55X6BkrAb3aDd6E/edit#slide=id.g13ea04b780d_1_97")
```

## Read into RStudio's environment

```{r, out.width="80%", echo=FALSE, fig.alt='.'}
ottrpal::include_slide("https://docs.google.com/presentation/d/104LQkFTsC5R9vAC4HHj4mK7IjCTH55X6BkrAb3aDd6E/edit#slide=id.g13ea04b780d_1_103")
```

## Check out the commands!

```{r, out.width="80%", echo=FALSE, fig.alt='.'}
ottrpal::include_slide("https://docs.google.com/presentation/d/104LQkFTsC5R9vAC4HHj4mK7IjCTH55X6BkrAb3aDd6E/edit#slide=id.g13ea04b780d_1_109")
```

## Approach #2 {.codesmall}
* Read into RStudio's environment directly

```{r}
ufo_data_complete_csv <- 
  read_csv("http://sisbid.github.io/Data-Wrangling/data/ufo/ufo_data_complete.csv.gz")
```

## Commenting in Scripts

Commenting in code is super important. You should be able to go back to your code years after writing it and figure out exactly what the script is doing. Commenting helps you do this. Also handy for notes!

```{r, out.width="80%", echo=FALSE, fig.alt='.'}
ottrpal::include_slide("https://docs.google.com/presentation/d/104LQkFTsC5R9vAC4HHj4mK7IjCTH55X6BkrAb3aDd6E/edit#slide=id.g13ea04b780d_1_115")
```

## Commenting in Scripts

```{r, echo = FALSE, out.width="70%"}
knitr::include_graphics("media/IO_comments_to_self.png")
```

## Data Input: `readr`

`read_delim()` and `read_csv()` from the`readr` package

```{r eval=FALSE} 
# example: 
read_delim(file = "file.txt", delim = "\t") 
read_csv("file.csv")
```

## Data Input

* The filename is the path to your file, in quotes
* The function will look in your "working directory" if no absolute file path is given
* Note that the filename can also be a path to a file on a website (e.g. 'www.someurl.com/table1.txt')

## Data Input

What if your file is in the "Home" directory?

```{r, out.width="80%", echo=FALSE, fig.alt='.'}
ottrpal::include_slide("https://docs.google.com/presentation/d/104LQkFTsC5R9vAC4HHj4mK7IjCTH55X6BkrAb3aDd6E/edit#slide=id.g13ea04b780d_1_121")
```

## Data Input

Backtrack using the relative path with `../` like:

```{r, eval = FALSE}
ufo <- read_csv("../ufo_data_complete.csv.gz")
```

## Data Input

Or, read in from a subfolder:

```{r, eval=FALSE}
ufo <- read_csv("data/ufo/ufo_data_complete.csv")
```

```{r, echo=FALSE}
ufo <- read_csv("../data/ufo/ufo_data_complete.csv")
```

## Data Input

The `read_delim()` and related functions return a "tibble" is a `data.frame` with special printing, which is the primary data format for most data cleaning and analyses. 

```{r viewInput, message=FALSE}
class(ufo)
```

## Data Input

```{r, viewTibble}
ufo
```

## Data Input

There are also data importing functions provided in base R (rather than the `readr` package), like `read.delim` and `read.csv`. 

These functions have slightly different syntax for reading in data, like `header` and `as.is`. 

However, while many online resources use the base R tools, recent versions of RStudio switched to use these new `readr` data import tools, so we will use them in the class for slides. They are also up to two times faster for reading in large datasets, and have a progress bar which is nice. 

## Data input: `readr` highlights

- Modern, improved tools from `readr` R package: `read_delim()`, `read_csv()`
  - needs a file path to be provided 
  - parses the file into rows/columns, determines column type 
  - returns a data frame 

- Some functions to look at a data frame: 
  - `head()` shows first few rows
  - `tail()` shows the last few rows
  - `View()` shows the data as a spreadsheet
  - `spec()` gives  specification of column types

## Data input: other file types

* From `readr` package: 
  - `read_delim()`: general delimited files 
  - `read_csv()`: comma separated (CSV) files
  - `read_tsv()`: tab separated files
  - others 
  
* For reading Excel files, you can do one of: 
  - use `read_excel()` function from `readxl` package
  - use other packages: `xlsx`, `openxlsx`

## Data input: other file types

* `haven` package has functions to read SAS, SPSS, Stata formats

```{r, eval = FALSE}
library(haven)

# SAS
read_sas(file = "mtcars.sas7bdat")

# SPSS
read_sav(file = "mtcars.sav")

# Stata
read_dta(file = "mtcars.dta")
```
